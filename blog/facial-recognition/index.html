<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/on-learning-new-things/component---src-layouts-index-js-1d457095af01b5bbd191.js" as="script"/><link rel="preload" href="/on-learning-new-things/component---src-templates-blog-template-js-b0c2fa9e4dd50e0858d2.js" as="script"/><link rel="preload" href="/on-learning-new-things/path---blog-facial-recognition-8581ceac309e622203c8.js" as="script"/><link rel="preload" href="/on-learning-new-things/app-de729fbbca7d925496c0.js" as="script"/><link rel="preload" href="/on-learning-new-things/commons-37e7ec241aad23eaba66.js" as="script"/><title data-react-helmet="true">On Learning New Things</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><style id="gatsby-inlined-css">@import url(https://fonts.googleapis.com/css?family=Montserrat:400,500,700|Playfair+Display:400,500);body{font-family:Montserrat,sans-serif;color:#4a4a4a}a{text-decoration:none}.rainbow-text{text-align:center}h2{font-family:Playfair Display,serif;font-size:20px;font-weight:700}a{color:#3949ab}.article-link>a{color:#000}.contact>a{display:block}.tags{display:-ms-grid;display:grid;-ms-grid-columns:(1fr)[2];grid-template-columns:repeat(2,1fr);margin-bottom:20px}img{display:block;margin-left:auto;margin-right:auto}h4{text-align:center}.container{margin-left:5%;margin-right:5%;display:-ms-grid;display:grid;-ms-grid-columns:3fr 1fr;grid-template-columns:3fr 1fr;grid-gap:30px}.continue-reading{font-weight:600;color:#4a4a4a}.rainbow-text span{font-weight:700;font-size:50px}.rainbow-text span:nth-child(10n+1){color:#ef5350}.rainbow-text span:nth-child(10n+2){color:#ab47bc}.rainbow-text span:nth-child(10n+3){color:#651fff}.rainbow-text span:nth-child(10n+4){color:#3949ab}.rainbow-text span:nth-child(10n+5){color:#2196f3}.rainbow-text span:nth-child(10n+6){color:#00bcd4}.rainbow-text span:nth-child(10n+7){color:#4caf50}.rainbow-text span:nth-child(10n+8){color:#ffc107}.rainbow-text span:nth-child(10n+9){color:#ff80ab}.rainbow-text span:nth-child(10n+10){color:#ff8f00}.red{background-color:#ef5350}.pink{background-color:#ff80ab}.purple{background-color:#651fff}.blog-post-container{margin-left:5%;margin-right:5%}.vertical-line{border-left:1px solid #4a4a4a;height:100%;padding-left:20px}.shapes>div{text-align:center;height:50px;width:50px;display:inline-block;margin-left:15px}.circle{border-radius:50%}.blue{background-color:#00bcd4}.green{background-color:#4caf50}.yellow{background-color:#ffc107}.triangle{-webkit-clip-path:polygon(50% 0,0 100%,100% 100%);clip-path:polygon(50% 0,0 100%,100% 100%)}@media (max-width:850px){.container{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column}.about,.vertical-line{display:none}}@media (max-width:600px){.rainbow-text span{font-size:30px}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style></head><body><div id="___gatsby"><div data-reactroot="" data-reactid="1" data-react-checksum="1591265119"><!-- react-empty: 2 --><div data-reactid="3"><a href="/on-learning-new-things/" data-reactid="4"><h1 class="rainbow-text" data-reactid="5"><div data-reactid="6"><span data-reactid="7">O</span><span data-reactid="8">N</span><span data-reactid="9">  </span><span data-reactid="10">L</span><span data-reactid="11">E</span><span data-reactid="12">A</span><span data-reactid="13">R</span><span data-reactid="14">N</span><span data-reactid="15">I</span><span data-reactid="16">N</span><span data-reactid="17">G</span><span data-reactid="18">  </span><span data-reactid="19">N</span><span data-reactid="20">E</span><span data-reactid="21">W</span></div><div data-reactid="22"><span data-reactid="23">T</span><span data-reactid="24">H</span><span data-reactid="25">I</span><span data-reactid="26">N</span><span data-reactid="27">G</span><span data-reactid="28">S</span></div></h1></a></div><div class="blog-post-container" data-reactid="29"><div class="blog-post" data-reactid="30"><h1 data-reactid="31">Facial Recognition in JavaScript using Tracking.js</h1><h2 data-reactid="32">December 06, 2017</h2><div class="blog-post-content" data-reactid="33"><p>Earlier this week, I saw <a href="https://dev.to/unqlite_db/progamming-snapchat-like-filters-cod">a really cool article</a> about how to create Snapchat like filters in Python. I was curious whether similar opensource technology existed for the frontend. I found a couple resources:</p>
<ul>
<li><a href="https://trackingjs.com/">Tracking.js</a></li>
<li><a href="https://github.com/auduno/clmtrackr">clmtrackr</a></li>
<li><a href="https://github.com/liuliu/ccv">ccv</a></li>
<li><a href="https://github.com/auduno/headtrackr">headtrackr</a></li>
</ul>
<p>I was really excited that this data-sciencey technology existed on the front-end instead of just in more traditional data science languages like Python or R.</p>
<p>I thought all of the above projects were very interesting, and they all had relatively similar star-level's on GitHub. I decided to use Tracking.js because the documentation was really good, and there were a bunch of examples which, for me is the easiest way to learn! I do wish there was better documentation on what was going on behind the scenes with this library -- I'm not sure what statistics are going on or how the tool works past implementation.</p>
<p>That being said, it was very easy to implement. I could easily extend the <a href="https://github.com/auduno/headtrackr">face camera example</a> for the purposes of the app I ended up building!</p>
<h2>The Learning Process</h2>
<p>Since Tracking.js is a smaller library with less of a community behind it than I normally end up using, my learning was pretty limited to looking at the examples on their website. I did search Codepen, but the few pens on there seemed to be incomplete or very similar to the examples.</p>
<h2>The Final Project</h2>
<p>Warning: I definitely learned throughout this project that webcam selfies are super awkward! I have no idea how I had a webcam selfie as my profile pic on Facebook back in high school!</p>
<p>I started off by copying the <a href="https://github.com/auduno/headtrackr">face camera example</a> on the tracking.js site. I ended up getting it working locally, with a few tweaks, and with downloading the tracking library locally.</p>
<p><img src="https://thepracticaldev.s3.amazonaws.com/i/a72o42eg3iok91f0rncv.png" alt="the example code"></p>
<p>Then, I found a couple PNG's online to layer on top to be the filters. I just used Google Image search and then copied them locally. I then implemented a simple algorithm for adding the filter to the face -- I just hard-coded the dimensions based on where the user's face was. It ended up looking like this:</p>
<p><img src="https://thepracticaldev.s3.amazonaws.com/i/lquvj2ouzrtxjuiu64ps.png">
<img src="https://thepracticaldev.s3.amazonaws.com/i/cc1k91nw1csmyqpmnpg4.png"></p>
<p>I also tried to implement the dog face that Snapchat has, but the math turned out to be too specific to the person's face for something as quick as this project!</p>
<p>I then generalized the math and added the ability for the user to switch between the filters. The math was relatively easy -- the event listener that fires when the person moves on the screen returns an array of the coordinates of the faces within view. Then I would draw the filter on top using my improved coordinates. The key code looked like this:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js">    context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>filterX <span class="token operator">*</span> rect<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>
      rect<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>filterY <span class="token operator">*</span> rect<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span>
      rect<span class="token punctuation">.</span>width <span class="token operator">*</span> filterWidth<span class="token punctuation">,</span>
      rect<span class="token punctuation">.</span>height <span class="token operator">*</span> filterHeight
    <span class="token punctuation">)</span>
</code></pre>
      </div>
<p>After that, I polished up the CSS, which was really hard! The way this ended up working was layering a HTML Canvas over a video element, so getting the grid system to align everything was really tricky. I ended up plugging in CSS Grid for the first time to see if that would work. It ended up working, but the way I did it felt hacky. I will have to keep looking at CSS Grid in the future!</p>
<p>The app ended up looking like this:
<img src="https://thepracticaldev.s3.amazonaws.com/i/fasbgn8vuw8r3naypvvo.png">
<img src="https://thepracticaldev.s3.amazonaws.com/i/cg3v790nwbjf0ekzofcq.png"></p>
<p>My final output seems okay, it is by no means perfect, but to get it better I would probably have to create my own library or my own filters. I also really struggled to get more complex filters to work. I would have had to break them up into their parts -- like each ear and the nose -- and then figure out the math to add these to each face. I seemed to have issues linking the different facial features back together if I wanted to track the eyes or mouth separately, rather than the face as a whole. </p>
<p>If I wanted to put more into this project, I would probably have also tried to add some smoothing so that the filter jumps less when a person moved a tiny bit. Overall, the project probably could have been better but I achieved what I wanted to in order to learn the library.</p>
<h2>Next Steps</h2>
<p>Tracking.js is really cool and well documented! I think its a great library for doing something simple like this app. If I were to do this for a job or something larger, I would probably have to improve a lot of the functionality in the app. I also found the webcam API to be shockingly difficult to use -- I struggled to find examples of styling and picture taking online. I would also like to look into it more in the future. Overall, I had fun with this! It isn't perfect, but it was a good quick project.</p>
<p><a href="https://github.com/aspittel/tracking/">Code</a>
<a href="https://aspittel.github.io/tracking/">App</a></p>
<p><strong>Part of my <a href="https://medium.com/on-learning-new-things/learning-new-things-f4db7f16724">On Learning New Things</a> Series</strong></p></div></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-de729fbbca7d925496c0.js","122212659448958":"component---src-templates-blog-template-js-b0c2fa9e4dd50e0858d2.js","50739212244294":"component---src-templates-tags-js-838eddff46fddb5dfa01.js","162898551421021":"component---src-pages-404-js-4503918ea3a16cfcdb75.js","35783957827783":"component---src-pages-index-js-2d8370aac263077f077e.js","60335399758886":"path----557518bd178906f8d58a.js","14397910593448":"path---blog-sketch-802715cfc03f81791f37.js","277440900667115":"path---blog-electron-f88dc85572ca33379ebb.js","278183092840852":"path---blog-hyperapp-14d60aaddc22d346b795.js","266857328088181":"path---blog-angular-38cbd0545a32954e8cde.js","280534838832661":"path---blog-go-53f73efcab5b27d81e47.js","214721871774937":"path---blog-facial-recognition-8581ceac309e622203c8.js","18826368022058":"path---blog-socket-io-cb85c81632d922ad7c63.js","173203448334963":"path---blog-portfolio-3bfaba8cba913fcec69c.js","150126350409309":"path---blog-css-art-6d82e128a9bd672a04a2.js","206703267315727":"path---blog-elm-53b59387b50441f6fff5.js","16961111620731":"path---blog-objection-66b0c08a076093af32f5.js","36163852562177":"path---blog-web-components-aece5ee72bccf098ad71.js","16116559206549":"path---tags-sketch-8b770c44fd86fecfd081.js","182244304492131":"path---tags-frontend-803a0668c044bd854b23.js","65951750749414":"path---tags-design-b4eb27f9ed7ef3c90e95.js","85240199557489":"path---tags-electron-0868a493b392b655acef.js","212641908305216":"path---tags-java-script-a6ded6dafd1f3a8ed139.js","142392486306457":"path---tags-desktop-4965dd1bcebbc512ec66.js","62117242295850":"path---tags-angular-8010624bb6a5bc3ea8b8.js","29981209658063":"path---tags-go-a051d916a10d5a3dc8e0.js","155610972471906":"path---tags-api-e617b678a928130fdf32.js","126371996568223":"path---tags-backend-1aac7f6964bff2fb59f2.js","191746713266591":"path---tags-postgre-sql-f02bd3b818e4d68665ec.js","127884858547399":"path---tags-data-science-20c41f09082d500e13c3.js","180636046567252":"path---tags-augmented-reality-2833ea985596d6774f22.js","264698647898761":"path---tags-websockets-f1e2c0c4569b78df3fad.js","209063065961547":"path---tags-css-99c98b3afca86c3b1386.js","15590976663347":"path---tags-art-492bc9efde252c8dc3a1.js","237869553599078":"path---tags-elm-e841f7189f93b599c06c.js","71230123872026":"path---tags-node-c6bd19143853242b1753.js","156812407687310":"path---tags-web-components-0bace97cf0d5ee015c8c.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-42af5c85ce61f6f4c895.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-1d457095af01b5bbd191.js"}/*]]>*/</script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/on-learning-new-things/commons-37e7ec241aad23eaba66.js","/on-learning-new-things/app-de729fbbca7d925496c0.js","/on-learning-new-things/path---blog-facial-recognition-8581ceac309e622203c8.js","/on-learning-new-things/component---src-templates-blog-template-js-b0c2fa9e4dd50e0858d2.js","/on-learning-new-things/component---src-layouts-index-js-1d457095af01b5bbd191.js"])/*]]>*/</script></body></html>